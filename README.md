# TransportCatalogue
Транспортный справочник. Работает с JSON - запросами. Выдаёт ответ на запрос отрисовки маршрутов строкой SVG формата. Реализован конструктор JSON с использованием цепочки вызовов методов, явные ошибки находятся на этапе компиляции.
## Описание
Принимает на вход запрос JSON-формата как на заполнение каталога, так и на считывание из него. Вывод результата тоже в JSON-формате. Если был отправлен запрос на визуализацию каталога, то на выход попадёт результат SVG-формамта.  
  
### Формат ввода
```c++
  {
    "base_requests": [             \\ запрос на заполнение каталога
    ...
    ],
    "render_settings": {           \\ запрос на установку настройки визуализации карты
    ...
    },
    "stat_requests": [             \\ запрос на считывание с каталога
    ...
    ]
  }
```
***  
1. Запрос на заполнение каталога имеет две вариации:
```c++
      {
        "type": "Bus",             \\ добавление автобуса в каталог
        "name": "...",             \\ имя автобуса
        "stops": [...],            \\ имена остановок, через которые проходит автобус записываются через запятую (например: "Морской вокзал", "Ривьерский мост" ...)
        "is_roundtrip": ...        \\ тип маршрута: true - кольцевой, false - прямой
      },
      {
        "type": "Stop",            \\ добавление остановки в каталог
        "name": "...",             \\ имя остановки
        "latitude": ...,           \\ координата по ширине
        "longitude": ...,          \\ координата по долготе
        "road_distances": {...}    \\ известное расстояние до других остановок записывается через запятую (например: "Ривьерский мост": 850, "Улица Лизы Чайкиной": 4300 ...)
      },
```
Кольцевой маршрут, заданный остановками A, B, C, D, A выглядит так:
![image](https://user-images.githubusercontent.com/93004994/164554862-a59001c1-f81e-4216-9e51-aebe5562c6a3.png)  
Прямой маршрут, заданный остановками A, B, C, D. Автобус проходит через остановки: A, B, C, D, C, B, A:
![image](https://user-images.githubusercontent.com/93004994/164555043-7c0a3fac-e7c5-4c7e-af06-922568708246.png)  
  
Запрос на установку настройки визуализации карты имеет следующий вид:
```c++
      "width": ...,                  \\ задаёт ширину в пикселях (вещественное число в диапазоне от 0 до 100000)
      "height": ...,                 \\ задаёт высоту в пикселях (вещественное число в диапазоне от 0 до 100000.)
      "padding": ...,                \\ отступ краёв карты от границ SVG-документа (вещественное число не меньше 0 и меньше min(width, height)/2)
      "stop_radius": ...,            \\ радиус окружностей, которыми обозначаются остановки (вещественное число в диапазоне от 0 до 100000)
      "line_width": ...,             \\ толщина линий, которыми рисуются автобусные маршруты (вещественное число в диапазоне от 0 до 100000)
      "bus_label_font_size": ...,    \\ размер текста, которым написаны названия автобусных маршрутов (целое число в диапазоне от 0 до 100000)
      "bus_label_offset": [..., ...],\\ смещение надписи с названием маршрута относительно координат конечной остановки на карте (элементы типа double в диапазоне от –100000 до 100000); задаёт значения свойств dx и dy SVG-элемента <text>
      "stop_label_font_size": ...,   \\ размер текста, которым отображаются названия остановок (целое число в диапазоне от 0 до 100000)
      "stop_label_offset": [...],    \\ смещение названия остановки относительно её координат на карте (элементы типа double в диапазоне от –100000 до 100000); задаёт значения свойств dx и dy SVG-элемента <text>
      "underlayer_color": [...],     \\ цвет подложки под названиями остановок и маршрутов (формат хранения цвета будет ниже)
      "underlayer_width": ...,       \\ толщина подложки под названиями остановок и маршрутов (вещественное число в диапазоне от 0 до 100000); задаёт значение атрибута stroke-width элемента <text>
      "color_palette": [...]         \\ цветовая палитра (непустой массив)
```
Цвет можно указать:
* в виде строки, например, "red" или "black";
* в массиве из трёх целых чисел диапазона [0, 255]. Они определяют r, g и b компоненты цвета в формате svg::Rgb. Цвет [255, 16, 12] нужно вывести как rgb(255, 16, 12);
* в массиве из четырёх элементов: три целых числа в диапазоне от [0, 255] и одно вещественное число в диапазоне от [0.0, 1.0]. Они задают составляющие red, green, blue и opacity цвета формата svg::Rgba. Цвет, заданный как [255, 200, 23, 0.85], будет выведен как rgba(255, 200, 23, 0.85).  
***  
2. Запрос на считывание с каталога:  
  
```c++
      { "id": 1, "type": "Stop", "name": "..." }, \\ запрос на вывод информации об остановке
      { "id": 2, "type": "Bus", "name": "..." },  \\ запрос на вывод информации о маршруте
      { "id": 3, "type": "Map" }                  \\ запрос на вывод карты SVG-формата
```
***  
### Формат вывода  
  
Результат вывода обрамляется квадратными кавычками [...]. Вывод информации происходит в том же порядке, в каком были запросы, и отделяется запятой.
  
На запрос об остановке вывод будет таким:  
```c++
    {
        "buses": [
             ...                    \\ здесь выводятся имена остановок, которые проходят через эту остановку, в кавычках через запятую (если нет ниодной остановки - "")
        ],
        "request_id": 1             \\ id запроса
    }
```
  

На запрос о маршруте вывод будет таким:  
```c++
    {
        "curvature": ...,           \\ извилистость, т.е. отношение фактической длины маршрута к географическому расстоянию (вещественное число, большее единицы*)
        "request_id": ...,          \\ фактическая длина маршрута в метрах
        "route_length": ...,        \\ длина маршрута (вычисленная по координатам остановок) в метрах
        "stop_count": ...,          \\ количество всех остановок маршрута
        "unique_stop_count": ...    \\ количество уникальных остановок маршрута
    }
```
> *Оно может быть равно единице только в том случае, если автобус едет между остановками по кратчайшему пути (и тогда больше похож на вертолёт). Меньше единицы - только благодаря телепортации или хордовым тоннелям.  
  
На запрос о выводе карты SVG-формата:  
```c++
<?xml version="1.0" encoding="UTF-8" ?>
<svg xmlns="http://www.w3.org/2000/svg" version="1.1">
  \\ 1. отрисовка линий маршрутов
  \\ 2. отрисовка названий маршрутов
  \\ 3. отрисовка символов остановок
  \\ 4. отрисовка названий остановок
</svg>
```
  
#### Особенности визуализации карты:
**1**. **отрисовка линий маршрутов:**  

Названия маршрутов должны отрисовываться у конечных остановок. В кольцевом маршруте — когда "is_roundtrip": true — конечной считается первая остановка маршрута. А в некольцевом — первая и последняя.  
Названия маршрутов выводите в порядке возрастания. Для каждого маршрута сначала следуют названия для первой конечной, а затем, если маршрут некольцевой и конечные не совпадают, — для второй.  
Если остановок у маршрута нет, его название отрисовываться не должно.  
Для каждого названия у конечной выведите два текстовых объекта: подложку и саму надпись.  
Общие свойства обоих объектов:  
  * x и y — координаты соответствующей остановки;
  * смещение dx и dy равно настройке bus_label_offset;
  * размер шрифта font-size равен настройке bus_label_font_size;
  * название шрифта font-family — "Verdana";
  * толщина шрифта font-weight — "bold".
  * содержимое — название автобуса.
 
Дополнительные свойства подложки:
  * цвет заливки fill и цвет линий stroke равны настройке underlayer_color;
  * толщина линий stroke-width равна настройке underlayer_width;
  * формы конца линии stroke-linecap и соединений stroke-linejoin равны round.

Дополнительное свойство самой надписи:
  * Цвет заливки fill равен цвету соответствующего автобусного маршрута из палитры.


## Инструкция по использованию
Перенесите файлы в свой проект и используйте шаблонный класс `SimpleVector<Type>`, который будет упрощённым аналогом контейнера `vector`.  
В файле `main` реализованы тесты, проверяющие работу `SimpleVector`.
## Системные требования
- С++17 (C++1z)
## Планы по доработке

***
![giffif](https://user-images.githubusercontent.com/93004994/164434944-d2e29257-6f92-4aae-a542-ecb36bd52df1.gif)
