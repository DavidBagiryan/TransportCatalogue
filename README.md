# TransportCatalogue
Транспортный справочник. Работает с `JSON`-запросами. Выдаёт ответ на запрос отрисовки маршрутов строкой `SVG` формата и информацию о быстрейшем пути. Реализован конструктор `JSON` с использованием цепочки вызовов методов, явные ошибки находятся на этапе компиляции.
## Описание
Принимает на вход запрос `JSON` формата как на заполнение каталога, так и на считывание из него. Вывод результата тоже в `JSON` формате. Если был отправлен запрос на визуализацию каталога, то на выход попадёт результат `SVG` формата.  
  
Время работы программы — не более двух секунд при 100 запросов на создание автобусов и остановок (не более 100 остановок в маршруте) и при 2000 запросов к уже созданной базе (не более 2 запросов на отрисовку).  
  
### Формат ввода
```c++
  {
    "base_requests": [             \\ запрос на заполнение каталога
    ...
    ],
    "render_settings": {           \\ запрос на установку настройки визуализации карты
    ...
    },
    "routing_settings": {          \\ запрос на установку настройки построения маршрута
    ...
    },
    "stat_requests": [             \\ запрос на считывание с каталога
    ...
    ]
  }
```
***  
1. Запрос на заполнение каталога имеет две вариации:
```c++
      {
        "type": "Bus",             \\ добавление автобуса в каталог
        "name": "...",             \\ имя автобуса
        "stops": [...],            \\ имена остановок, через которые проходит автобус записываются через запятую (например: "Морской вокзал", "Ривьерский мост" ...)
        "is_roundtrip": ...        \\ тип маршрута: true - кольцевой, false - прямой
      },
      {
        "type": "Stop",            \\ добавление остановки в каталог
        "name": "...",             \\ имя остановки
        "latitude": ...,           \\ координата по ширине
        "longitude": ...,          \\ координата по долготе
        "road_distances": {...}    \\ известное расстояние до других остановок записывается через запятую (например: "Ривьерский мост": 850, "Улица Лизы Чайкиной": 4300 ...)
      },
```
Кольцевой маршрут, заданный остановками A, B, C, D, A выглядит так:
![image](https://user-images.githubusercontent.com/93004994/164554862-a59001c1-f81e-4216-9e51-aebe5562c6a3.png)  
Прямой маршрут, заданный остановками A, B, C, D. Автобус проходит через остановки: A, B, C, D, C, B, A:
![image](https://user-images.githubusercontent.com/93004994/164555043-7c0a3fac-e7c5-4c7e-af06-922568708246.png)  
  
Запрос на установку настройки визуализации карты имеет следующий вид:
```c++
      "width": ...,                  \\ задаёт ширину в пикселях (вещественное число в диапазоне от 0 до 100000)
      "height": ...,                 \\ задаёт высоту в пикселях (вещественное число в диапазоне от 0 до 100000.)
      "padding": ...,                \\ отступ краёв карты от границ SVG-документа (вещественное число не меньше 0 и меньше min(width, height)/2)
      "stop_radius": ...,            \\ радиус окружностей, которыми обозначаются остановки (вещественное число в диапазоне от 0 до 100000)
      "line_width": ...,             \\ толщина линий, которыми рисуются автобусные маршруты (вещественное число в диапазоне от 0 до 100000)
      "bus_label_font_size": ...,    \\ размер текста, которым написаны названия автобусных маршрутов (целое число в диапазоне от 0 до 100000)
      "bus_label_offset": [..., ...],\\ смещение надписи с названием маршрута относительно координат конечной остановки на карте (элементы типа double в диапазоне от –100000 до 100000); задаёт значения свойств dx и dy SVG-элемента <text>
      "stop_label_font_size": ...,   \\ размер текста, которым отображаются названия остановок (целое число в диапазоне от 0 до 100000)
      "stop_label_offset": [...],    \\ смещение названия остановки относительно её координат на карте (элементы типа double в диапазоне от –100000 до 100000); задаёт значения свойств dx и dy SVG-элемента <text>
      "underlayer_color": [...],     \\ цвет подложки под названиями остановок и маршрутов (формат хранения цвета будет ниже)
      "underlayer_width": ...,       \\ толщина подложки под названиями остановок и маршрутов (вещественное число в диапазоне от 0 до 100000); задаёт значение атрибута stroke-width элемента <text>
      "color_palette": [...]         \\ цветовая палитра (непустой массив)
```
Цвет можно указать:
* в виде строки, например, `"red"` или `"black"`;
* в массиве из трёх целых чисел диапазона `[0, 255]`. Они определяют `r`, `g` и `b` компоненты цвета в формате `svg::Rgb`. Цвет `[255, 16, 12]` нужно вывести как `rgb(255, 16, 12)`;
* в массиве из четырёх элементов: три целых числа в диапазоне от `[0, 255]` и одно вещественное число в диапазоне от `[0.0, 1.0]`. Они задают составляющие `red`, `green`, `blue` и `opacity` цвета формата `svg::Rgba`. Цвет, заданный как `[255, 200, 23, 0.85]`, будет выведен как `rgba(255, 200, 23, 0.85)`.  
  
Запрос на установку настройки построения маршрута имеет следующий вид:
```c++
      "bus_wait_time": ...,         \\ время ожидания автобуса на остановке, в минутах
      "bus_velocity": ...           \\ скорость автобуса, в км/ч
```
***  
2. Запрос на считывание с каталога:  
  
```c++
      { "id": ..., "type": "Stop", "name": "..." }, \\ запрос на вывод информации об остановке
      { "id": ..., "type": "Bus", "name": "..." },  \\ запрос на вывод информации о маршруте
      { "id": ..., "type": "Map" },                 \\ запрос на вывод карты SVG-формата
      { "id": ..., "type": "Route", "from": "...", "to": "..." } \\ запрос на вывод информации о самом быстром маршруте
```
***  
### Формат вывода  
  
Результат вывода обрамляется квадратными кавычками [...]. Вывод информации происходит в том же порядке, в каком были запросы, и отделяется запятой.
  
На запрос об остановке вывод будет:  
```c++
    {
        "buses": [
             ...                    \\ здесь выводятся имена остановок, которые проходят через эту остановку, в кавычках через запятую (если нет ниодной остановки - "")
        ],
        "request_id" :...           \\ id запроса
    }
```
  

На запрос о маршруте вывод будет:  
```c++
    {
        "curvature": ...,           \\ извилистость, т.е. отношение фактической длины маршрута к географическому расстоянию (вещественное число, большее единицы*)
        "request_id": ...,          \\ фактическая длина маршрута в метрах
        "route_length": ...,        \\ длина маршрута (вычисленная по координатам остановок) в метрах
        "stop_count": ...,          \\ количество всех остановок маршрута
        "unique_stop_count": ...    \\ количество уникальных остановок маршрута
    }
```
> *Оно может быть равно единице только в том случае, если автобус едет между остановками по кратчайшему пути (и тогда больше похож на вертолёт). Меньше единицы - только благодаря телепортации или хордовым тоннелям.  
  
На запрос карты `SVG` формата вывод будет:  
```c++
    {
        "map": "<?xml version="1.0" encoding="UTF-8" ?>
                <svg xmlns="http://www.w3.org/2000/svg" version="1.1">
                 \\ 1. отрисовка линий маршрутов
                 \\ 2. отрисовка названий маршрутов
                 \\ 3. отрисовка символов остановок
                 \\ 4. отрисовка названий остановок
                </svg>",
        "request_id": 3
    }
```
  
На запрос о построении маршрута между остановками вывод будет:
```c++
    {
        "request_id": ...,        \\ id запроса
        "total_time": ...,        \\ суммарное время
        "items": [
            ...                   \\ элементы маршрута
        ]
    }
```
`items` — список элементов маршрута, каждый из которых описывает непрерывную активность пассажира, требующую временных затрат. А именно элементы маршрута бывают двух типов.  
1) `Wait` — подождать нужное количество минут (в нашем случае всегда `bus_wait_time`) на указанной остановке:
```c++
    {
        "type": "Wait",           \\ ожидание на остановке
        "stop_name": "...",       \\ имя остановки
        "time": ...               \\ время ожидания на остановке
    }
```
2) `Bus` — проехать `span_count` остановок (перегонов между остановками) на автобусе bus, потратив указанное количество минут:
```c++
    {
        "type": "Bus",            \\ движение на автобусе
        "bus": "...",             \\ имя автобуса
        "span_count": ...,        \\ количество пройденных остановок
        "time": ...               \\ пройденное время в пути
    }
```
#### Особенности визуализации карты:  
Проекция координат на карту:  
![image](https://user-images.githubusercontent.com/93004994/164631497-5eea7919-f757-40d6-ac60-d442c0eb0580.png)
Определение цветов:  
Из палитры `color_palette` выбираются цвета линий. Первый по алфавиту автобус должен получить первый цвет. Второй автобус — второй цвет. Если автобусов больше, чем цветов в палитре, цвета переиспользуются по циклу.
Если на маршруте нет остановок, следующий за ним маршрут должен использовать в палитре тот же индекс.  
  
**1**. **Отрисовка линий маршрутов:**  

Названия маршрутов отрисовываются у конечных остановок. В кольцевом маршруте — когда `"is_roundtrip"`: `true` — конечной считается первая остановка маршрута. А в некольцевом — первая и последняя.  
Названия маршрутов выводятся в порядке возрастания. Для каждого маршрута сначала следуют названия для первой конечной, а затем, если маршрут некольцевой и конечные не совпадают, — для второй.  
Если остановок у маршрута нет, его название не отрисовывается.  
Для каждого названия у конечной выводится два текстовых объекта: подложка и сама надпись.  
Общие свойства обоих объектов:  
  * `x` и `y` — координаты соответствующей остановки;
  * смещение `dx` и `dy` равно настройке `bus_label_offset`;
  * размер шрифта `font-size` равен настройке `bus_label_font_size`;
  * название шрифта `font-family` — `"Verdana"`;
  * толщина шрифта `font-weight` — `"bold"`.
  * содержимое — название автобуса.
 
Дополнительные свойства подложки:
  * цвет заливки `fill` и цвет линий `stroke` равны настройке `underlayer_color`;
  * толщина линий `stroke-width` равна настройке `underlayer_width`;
  * формы конца линии `stroke-linecap` и соединений `stroke-linejoin` равны `"round"`.

Дополнительное свойство самой надписи:
  * Цвет заливки `fill` равен цвету соответствующего автобусного маршрута из палитры.  
  
**2**. **Отрисовка названий маршрутов:**  

Названия маршрутов отрисовываются у конечных остановок. В кольцевом маршруте — когда `"is_roundtrip"`: `true` — конечной считается первая остановка маршрута. А в некольцевом — первая и последняя.  
Названия маршрутов выводятся в порядке возрастания. Для каждого маршрута сначала следуют названия для первой конечной, а затем, если маршрут некольцевой и конечные не совпадают, — для второй.  
Если остановок у маршрута нет, его название не отрисовывается.  
Для каждого названия у конечной выводится два текстовых объекта: подложка и сама надпись.  
Общие свойства обоих объектов:  
  * `x` и `y` — координаты соответствующей остановки;
  * смещение `dx` и `dy` равно настройке `bus_label_offset`;
  * размер шрифта `font-size` равен настройке `bus_label_font_size`;
  * название шрифта `font-family` — `"Verdana"`;
  * толщина шрифта `font-weight` — `"bold"`.
  * содержимое — название автобуса.
Дополнительные свойства подложки:  
  * цвет заливки `fill` и цвет линий `stroke` равны настройке `underlayer_color`;
  * толщина линий `stroke-width` равна настройке `underlayer_width`;
  * формы конца линии `stroke-linecap` и соединений `stroke-linejoin` равны `"round"`.
Дополнительное свойство самой надписи:  
  * Цвет заливки `fill` равен цвету соответствующего автобусного маршрута из палитры.
  
**3**. **отрисовка символов остановок:**  

Остановки обозначаются символами. Они отрисовываются для всех маршрутов, где есть остановки. Одна остановка — один символ. Выводятся символы по одному в порядке возрастания названия остановки, независимо от количества автобусов, которые через неё проходят. Остановки, через которые не проходит ни один автобус, не выводятся.  
Свойства символа остановки:  
  * координаты центра `cx` и `cy` — координаты соответствующей остановки;
  * радиус `r` равен настройке `stop_radius`;
  * цвет заливки `fill` — `"white"`.
  
**4**. **отрисовка названий остановок:**  

Выводятся названия в лексикографическом порядке, по одному на каждую остановку, независимо от количества автобусов, которые через неё проходят. Названия остановок, через которые не проходит ни один маршрут не отрисовываются.  
Для каждой остановки выводятся два текстовых объекта: подложка и сама надпись.  
Общие свойства обоих объектов:  
  * `x` и `y` — координаты соответствующей остановки;
  * смещение `dx` и `dy` равно настройке `stop_label_offset`;
  * размер шрифта `font-size` равен настройке `stop_label_font_size`;
  * название шрифта `font-family` — `"Verdana"`;
  * свойства `font-weight` быть не должно;
  * содержимое — название остановки.

Дополнительные свойства подложки:  
  * цвет заливки `fill` и цвет линий `stroke` равны настройке `underlayer_color`;
  * толщина линий `stroke-width` равна настройке `underlayer_width`;
  * формы конца линии `stroke-linecap` и соединений `stroke-linejoin` равны `"round"`.

Дополнительное свойство самой надписи:  
  * цвет заливки `fill` — `"black"`.

### Пример
> Ввод:  
```c++
  {
      "base_requests": [
          {
              "is_roundtrip": true,
              "name": "297",
              "stops": [
                  "Biryulyovo Zapadnoye",
                  "Biryulyovo Tovarnaya",
                  "Universam",
                  "Biryulyovo Zapadnoye"
              ],
              "type": "Bus"
          },
          {
              "is_roundtrip": false,
              "name": "635",
              "stops": [
                  "Biryulyovo Tovarnaya",
                  "Universam",
                  "Prazhskaya"
              ],
              "type": "Bus"
          },
          {
              "latitude": 55.574371,
              "longitude": 37.6517,
              "name": "Biryulyovo Zapadnoye",
              "road_distances": {
                  "Biryulyovo Tovarnaya": 2600
              },
              "type": "Stop"
          },
          {
              "latitude": 55.587655,
              "longitude": 37.645687,
              "name": "Universam",
              "road_distances": {
                  "Biryulyovo Tovarnaya": 1380,
                  "Biryulyovo Zapadnoye": 2500,
                  "Prazhskaya": 4650
              },
              "type": "Stop"
          },
          {
              "latitude": 55.592028,
              "longitude": 37.653656,
              "name": "Biryulyovo Tovarnaya",
              "road_distances": {
                  "Universam": 890
              },
              "type": "Stop"
          },
          {
              "latitude": 55.611717,
              "longitude": 37.603938,
              "name": "Prazhskaya",
              "road_distances": {},
              "type": "Stop"
          }
      ],
      "render_settings": {
          "bus_label_font_size": 20,
          "bus_label_offset": [
              7,
              15
          ],
          "color_palette": [
              "green",
              [
                  255,
                  160,
                  0
              ],
              "red"
          ],
          "height": 200,
          "line_width": 14,
          "padding": 30,
          "stop_label_font_size": 20,
          "stop_label_offset": [
              7,
              -3
          ],
          "stop_radius": 5,
          "underlayer_color": [
              255,
              255,
              255,
              0.85
          ],
          "underlayer_width": 3,
          "width": 200
      },
      "routing_settings": {
          "bus_velocity": 40,
          "bus_wait_time": 6
      },
      "stat_requests": [
          {
              "id": 1,
              "name": "297",
              "type": "Bus"
          },
          {
              "id": 2,
              "name": "635",
              "type": "Bus"
          },
          {
              "id": 3,
              "name": "Universam",
              "type": "Stop"
          },
		  {
              "id": 4,
              "type": "Map"
          },
          {
              "from": "Biryulyovo Zapadnoye",
              "id": 5,
              "to": "Universam",
              "type": "Route"
          },
          {
              "from": "Biryulyovo Zapadnoye",
              "id": 6,
              "to": "Prazhskaya",
              "type": "Route"
          }
      ]
  }
```
> Вывод:  
```c++
[
    {
        "curvature": 1.42963,
        "request_id": 1,
        "route_length": 5990,
        "stop_count": 4,
        "unique_stop_count": 3
    },
    {
        "curvature": 1.30156,
        "request_id": 2,
        "route_length": 11570,
        "stop_count": 5,
        "unique_stop_count": 3
    },
    {
        "buses": [
            "297",
            "635"
        ],
        "request_id": 3
    },
    {
        "map": "<?xml version=\"1.0\" encoding=\"UTF-8\" ?>\n<svg xmlns=\"http://www.w3.org/2000/svg\" version=\"1.1\">\n  <polyline points=\"164.492,135.162 170,85.4419 147.56,97.7557 164.492,135.162\" fill=\"none\" stroke=\"green\" stroke-width=\"14\" stroke-linecap=\"round\" stroke-linejoin=\"round\" />\n  <polyline points=\"170,85.4419 147.56,97.7557 30,30 147.56,97.7557 170,85.4419\" fill=\"none\" stroke=\"rgb(255,160,0)\" stroke-width=\"14\" stroke-linecap=\"round\" stroke-linejoin=\"round\" />\n  <text x=\"164.492\" y=\"135.162\" dx=\"7\" dy=\"15\" font-size=\"20\" font-family=\"Verdana\" font-weight=\"bold\" fill=\"rgba(255,255,255,0.85)\" stroke=\"rgba(255,255,255,0.85)\" stroke-width=\"3\" stroke-linecap=\"round\" stroke-linejoin=\"round\">297</text>\n  <text x=\"164.492\" y=\"135.162\" dx=\"7\" dy=\"15\" font-size=\"20\" font-family=\"Verdana\" font-weight=\"bold\" fill=\"green\">297</text>\n  <text x=\"170\" y=\"85.4419\" dx=\"7\" dy=\"15\" font-size=\"20\" font-family=\"Verdana\" font-weight=\"bold\" fill=\"rgba(255,255,255,0.85)\" stroke=\"rgba(255,255,255,0.85)\" stroke-width=\"3\" stroke-linecap=\"round\" stroke-linejoin=\"round\">635</text>\n  <text x=\"170\" y=\"85.4419\" dx=\"7\" dy=\"15\" font-size=\"20\" font-family=\"Verdana\" font-weight=\"bold\" fill=\"rgb(255,160,0)\">635</text>\n  <text x=\"30\" y=\"30\" dx=\"7\" dy=\"15\" font-size=\"20\" font-family=\"Verdana\" font-weight=\"bold\" fill=\"rgba(255,255,255,0.85)\" stroke=\"rgba(255,255,255,0.85)\" stroke-width=\"3\" stroke-linecap=\"round\" stroke-linejoin=\"round\">635</text>\n  <text x=\"30\" y=\"30\" dx=\"7\" dy=\"15\" font-size=\"20\" font-family=\"Verdana\" font-weight=\"bold\" fill=\"rgb(255,160,0)\">635</text>\n  <circle cx=\"170\" cy=\"85.4419\" r=\"5\" fill=\"white\"/>\n  <circle cx=\"164.492\" cy=\"135.162\" r=\"5\" fill=\"white\"/>\n  <circle cx=\"30\" cy=\"30\" r=\"5\" fill=\"white\"/>\n  <circle cx=\"147.56\" cy=\"97.7557\" r=\"5\" fill=\"white\"/>\n  <text x=\"170\" y=\"85.4419\" dx=\"7\" dy=\"-3\" font-size=\"20\" font-family=\"Verdana\" fill=\"rgba(255,255,255,0.85)\" stroke=\"rgba(255,255,255,0.85)\" stroke-width=\"3\" stroke-linecap=\"round\" stroke-linejoin=\"round\">Biryulyovo Tovarnaya</text>\n  <text x=\"170\" y=\"85.4419\" dx=\"7\" dy=\"-3\" font-size=\"20\" font-family=\"Verdana\" fill=\"black\">Biryulyovo Tovarnaya</text>\n  <text x=\"164.492\" y=\"135.162\" dx=\"7\" dy=\"-3\" font-size=\"20\" font-family=\"Verdana\" fill=\"rgba(255,255,255,0.85)\" stroke=\"rgba(255,255,255,0.85)\" stroke-width=\"3\" stroke-linecap=\"round\" stroke-linejoin=\"round\">Biryulyovo Zapadnoye</text>\n  <text x=\"164.492\" y=\"135.162\" dx=\"7\" dy=\"-3\" font-size=\"20\" font-family=\"Verdana\" fill=\"black\">Biryulyovo Zapadnoye</text>\n  <text x=\"30\" y=\"30\" dx=\"7\" dy=\"-3\" font-size=\"20\" font-family=\"Verdana\" fill=\"rgba(255,255,255,0.85)\" stroke=\"rgba(255,255,255,0.85)\" stroke-width=\"3\" stroke-linecap=\"round\" stroke-linejoin=\"round\">Prazhskaya</text>\n  <text x=\"30\" y=\"30\" dx=\"7\" dy=\"-3\" font-size=\"20\" font-family=\"Verdana\" fill=\"black\">Prazhskaya</text>\n  <text x=\"147.56\" y=\"97.7557\" dx=\"7\" dy=\"-3\" font-size=\"20\" font-family=\"Verdana\" fill=\"rgba(255,255,255,0.85)\" stroke=\"rgba(255,255,255,0.85)\" stroke-width=\"3\" stroke-linecap=\"round\" stroke-linejoin=\"round\">Universam</text>\n  <text x=\"147.56\" y=\"97.7557\" dx=\"7\" dy=\"-3\" font-size=\"20\" font-family=\"Verdana\" fill=\"black\">Universam</text>\n</svg> ",
        "request_id": 4
    },
    {
        "items": [
            {
                "stop_name": "Biryulyovo Zapadnoye",
                "time": 6,
                "type": "Wait"
            },
            {
                "bus": "297",
                "span_count": 2,
                "time": 5.235,
                "type": "Bus"
            }
        ],
        "request_id": 5,
        "total_time": 11.235
    },
    {
        "items": [
            {
                "stop_name": "Biryulyovo Zapadnoye",
                "time": 6,
                "type": "Wait"
            },
            {
                "bus": "297",
                "span_count": 2,
                "time": 5.235,
                "type": "Bus"
            },
            {
                "stop_name": "Universam",
                "time": 6,
                "type": "Wait"
            },
            {
                "bus": "635",
                "span_count": 1,
                "time": 6.975,
                "type": "Bus"
            }
        ],
        "request_id": 6,
        "total_time": 24.21
    }
]
```
## Инструкция по использованию
Перенесите файлы в свой проект.
## Системные требования
- С++17 (C++1z)
## Планы по доработке
Применить сериализацию.
***
![giffif](https://user-images.githubusercontent.com/93004994/164434944-d2e29257-6f92-4aae-a542-ecb36bd52df1.gif)
